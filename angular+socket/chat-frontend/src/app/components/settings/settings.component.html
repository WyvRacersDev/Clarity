<div class="settings-container">
  <div class="settings-header">
    <h1>Settings</h1>
    <p class="subtitle">Manage your preferences and integrations</p>
  </div>

  <div class="settings-sections">

    <div class="settings-section">
      <h2>Notifications</h2>
      <div class="setting-item">
        <div class="setting-info">
          <div class="setting-label">Receive Notifications</div>
          <div class="setting-description">
            Get notified about task deadlines and project updates
          </div>
        </div>
        <label class="toggle-switch">
          <input
            type="checkbox"
            [checked]="userSettings?.recieve_notifications"
            (change)="toggleNotifications()"
            />
          <span class="slider"></span>
        </label>
      </div>
    </div>


    <div class="settings-section">
      <h2>Collaboration</h2>
      <div class="setting-item">
        <div class="setting-info">
          <div class="setting-label">Allow Invites</div>
          <div class="setting-description">Allow others to invite you to projects</div>
        </div>
        <label class="toggle-switch">
          <input
            type="checkbox"
            [checked]="userSettings?.allow_invite"
            (change)="toggleInvites()"
            />
          <span class="slider"></span>
        </label>
      </div>
    </div>

    <div class="settings-section">
      <h2>Google Integrations</h2>
      <p class="section-description">
        Connect your Google services to sync calendars, contacts, and emails
      </p>

      <div class="integration-item">
        <div class="integration-info">
          <div class="integration-icon">üìÖ</div>
          <div class="integration-details">
            <div class="integration-name">Google Calendar</div>
            <div class="integration-description">Sync your calendar events and schedule tasks</div>
          </div>
        </div>
        <div class="integration-actions">
          @if (isGoogleCalendarConnected()) {
            <span class="status-badge connected">Connected</span>
          }
          @if (!isGoogleCalendarConnected()) {
            <span class="status-badge disconnected"
              >Not Connected</span
              >
            }
            @if (!isGoogleCalendarConnected()) {
              <button
                class="connect-btn"
                (click)="connectGoogleCalendar()"
                [disabled]="isConnectingCalendar"
                >
                {{ isConnectingCalendar ? 'Connecting...' : 'Connect' }}
              </button>
            }
            @if (isGoogleCalendarConnected()) {
              <button
                class="disconnect-btn"
                (click)="disconnectGoogleCalendar()"
                >
                Disconnect
              </button>
            }
          </div>
        </div>


        <div class="integration-item">
          <div class="integration-info">
            <div class="integration-icon">üë•</div>
            <div class="integration-details">
              <div class="integration-name">Google Contacts</div>
              <div class="integration-description">
                Access your contacts for project collaboration
              </div>
            </div>
          </div>
          <div class="integration-actions">
            @if (isGoogleContactsConnected()) {
              <span class="status-badge connected">Connected</span>
            }
            @if (!isGoogleContactsConnected()) {
              <span class="status-badge disconnected"
                >Not Connected</span
                >
              }
              @if (!isGoogleContactsConnected()) {
                <button
                  class="connect-btn"
                  (click)="connectGoogleContacts()"
                  [disabled]="isConnectingContacts"
                  >
                  {{ isConnectingContacts ? 'Connecting...' : 'Connect' }}
                </button>
              }
              @if (isGoogleContactsConnected()) {
                <button
                  class="disconnect-btn"
                  (click)="disconnectGoogleContacts()"
                  >
                  Disconnect
                </button>
              }
            </div>
          </div>

          <div class="integration-item">
            <div class="integration-info">
              <div class="integration-icon">üìß</div>
              <div class="integration-details">
                <div class="integration-name">Gmail</div>
                <div class="integration-description">Send invites and notifications via email</div>
              </div>
            </div>
            <div class="integration-actions">
              @if (isGmailConnected()) {
                <span class="status-badge connected">Connected</span>
              }
              @if (!isGmailConnected()) {
                <span class="status-badge disconnected">Not Connected</span>
              }
              @if (!isGmailConnected()) {
                <button
                  class="connect-btn"
                  (click)="connectGmail()"
                  [disabled]="isConnectingGmail"
                  >
                  {{ isConnectingGmail ? 'Connecting...' : 'Connect' }}
                </button>
              }
              @if (isGmailConnected()) {
                <button class="disconnect-btn" (click)="disconnectGmail()">
                  Disconnect
                </button>
              }
            </div>
          </div>
        </div>

        @if (isGmailConnected()) {
          <div class="settings-section">
            <h2>Import Contacts</h2>
            <p class="section-description">
              Import your Google Contacts to easily collaborate with others
            </p>
            <div class="import-contacts-section">
              <div class="import-info">
                @if (!userSettings?.allow_invite) {
                  <p class="warning-text">
                    ‚ö†Ô∏è Enable "Allow Invites" above to import contacts
                  </p>
                }
                @if (userSettings?.allow_invite && userContacts.length === 0) {
                  <p class="info-text">
                    No contacts imported yet. Click the button below to import from Google.
                  </p>
                }
                @if (userContacts.length > 0) {
                  <p class="success-text">
                    ‚úì {{ userContacts.length }} contacts imported
                  </p>
                }
              </div>
              <button
                class="import-btn"
                (click)="importGoogleContacts()"
                [disabled]="isImportingContacts || !userSettings?.allow_invite"
                >
                {{ isImportingContacts ? 'Importing...' : 'Import Google Contacts' }}
              </button>
              @if (importMessage) {
                <div
                  class="import-message"
                  [class.success]="importSuccess"
                  [class.error]="!importSuccess"
                  >
                  {{ importMessage }}
                </div>
              }

              @if (userContacts.length > 0) {
                <div class="contacts-list">
                  <h3>Imported Contacts ({{ userContacts.length }})</h3>
                  <div class="contacts-grid">
                    @for (contact of userContacts; track contact) {
                      <div class="contact-item">
                        <div class="contact-avatar">{{ contact.name?.charAt(0)?.toUpperCase() || '?' }}</div>
                        <div class="contact-info">
                          <div class="contact-name">{{ contact.name || 'Unknown' }}</div>
                          <div class="contact-email">
                            {{ contact.contact_detail || contact.email || 'No email' }}
                          </div>
                        </div>
                      </div>
                    }
                  </div>
                </div>
              }
            </div>
          </div>
        }

        <div class="settings-section">
          <h2>Server Configuration</h2>
          <p class="section-description">
            Configure the server IP/URL where hosted projects are stored
          </p>

          <div class="server-config-item">
            <div class="setting-info">
              <div class="setting-label">Server URL</div>
              <div class="setting-description">
                Enter the server address (e.g., http://192.168.1.100:3000 or http://yourdomain.com:3000)
              </div>
            </div>
            <div class="server-config-input-group">
              <input
                type="text"
                [(ngModel)]="serverUrl"
                placeholder="http://localhost:3000"
                class="server-url-input"
                [disabled]="isSavingServerConfig"
                />
              <div class="server-config-buttons">
                <button
                  class="save-btn"
                  (click)="saveServerConfig()"
                  [disabled]="isSavingServerConfig || !serverUrl.trim()"
                  >
                  {{ isSavingServerConfig ? 'Saving...' : 'Save' }}
                </button>
                <button
                  class="reset-btn"
                  (click)="resetServerConfig()"
                  [disabled]="isSavingServerConfig"
                  >
                  Reset to Default
                </button>
              </div>
            </div>
            <div class="server-config-note">
              <p>
                <strong>Note:</strong> Changing the server URL will reload the page. Make sure the
                server is accessible at the specified address.
              </p>
            </div>
          </div>
        </div>

     
        <div class="settings-section">
          <h2>Account Information</h2>
          <div class="account-info">
            <div class="info-item">
              <div class="info-label">Name</div>
              <div class="info-value">{{ currentUser?.name || 'N/A' }}</div>
            </div>
            <div class="info-item">
              <div class="info-label">User ID</div>
              <div class="info-value">{{ currentUser?.name || 'N/A' }}</div>
            </div>
            <div class="info-item">
              <div class="info-label">Projects</div>
              <div class="info-value">{{ currentUser?.projects?.length || 0 }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>
