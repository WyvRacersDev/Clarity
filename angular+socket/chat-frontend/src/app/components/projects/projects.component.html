<div class="projects-container">
  <div class="projects-header">
    <h1>Projects</h1>
    <button class="create-btn" (click)="openCreateModal()" [disabled]="isLoading">
      <span class="btn-icon">‚ûï</span>
      New Project
    </button>
  </div>

  <!-- Loading indicator -->
  @if (isLoading) {
    <div class="loading-container">
      <div class="spinner-large"></div>
      <p>Loading projects...</p>
    </div>
  }

  @if (!isLoading && currentUser && currentUser.projects.length > 0) {
    <div class="projects-list">
      @for (project of currentUser.projects; track project; let i = $index) {
        <div
          class="project-card"
          (click)="selectProject(i)"
          >
          <div class="project-card-header">
            <div class="project-title-section">
              <h2>{{ project.name }}</h2>
              <span class="project-type-badge" [class.local]="isLocalProject(project)" [class.hosted]="!isLocalProject(project)">
                {{ isLocalProject(project) ? 'üìÅ Local' : 'üåê Hosted' }}
              </span>
            </div>
            <button
              class="delete-btn"
              (click)="deleteProject(i, $event)"
              title="Delete project"
              [disabled]="isDeleting && deletingProjectIndex === i"
              >
              @if (isDeleting && deletingProjectIndex === i) {
                <span class="spinner-small"></span>
              }
              @if (!(isDeleting && deletingProjectIndex === i)) {
                <img src="/assets/bin.png" alt="Delete" style="width: 20px; height: 20px;">
              }
            </button>
          </div>
          <div class="project-stats">
            <span>{{ project.grid.length }} grids</span>
          </div>
        </div>
      }
    </div>
  }

  @if (!isLoading && (!currentUser || currentUser.projects.length === 0)) {
    <div class="empty-projects">
      <h2>No projects yet</h2>
      <p>Create a new project to get started</p>
    </div>
  }

  <!-- Create Project Modal -->
  @if (showCreateModal) {
    <div class="modal-overlay" (click)="closeCreateModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Create New Project</h2>
          <button class="close-btn" (click)="closeCreateModal()">√ó</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Project Name *</label>
            <input
              type="text"
              [(ngModel)]="newProjectName"
              placeholder="Enter project name"
              (keydown.enter)="$event.preventDefault(); createProject()"
              >
          </div>
          <div class="form-group">
            <label>Project Type</label>
            <select [(ngModel)]="projectType" [disabled]="!isLocalProjectsAvailable() && projectType === 'local'">
              <option value="local" [disabled]="!isLocalProjectsAvailable()">üìÅ Local Project {{ !isLocalProjectsAvailable() ? '(Only on localhost)' : '' }}</option>
              <option value="hosted">üåê Hosted/Shared Project</option>
            </select>
            @if (!isLocalProjectsAvailable()) {
              <p class="form-hint">
                Local projects are only available when connected to localhost. Switch to hosted projects or connect to a local server.
              </p>
            }
          </div>
        </div>
        <div class="modal-footer">
          <button class="cancel-btn" (click)="closeCreateModal()">Cancel</button>
          <button
            class="submit-btn"
            (click)="createProject()"
            [disabled]="!newProjectName.trim() || isSaving"
            >
            @if (isSaving) {
              <span class="spinner-small"></span>
            }
            @if (!isSaving) {
              <span>Create</span>
            }
          </button>
        </div>
      </div>
    </div>
  }

  <!-- Error Modal -->
  @if (showErrorModal) {
    <div class="modal-overlay" (click)="closeErrorModal()">
      <div class="modal-content error-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <img src="/assets/warning.png" alt="Warning" style="width: 24px; height: 24px;">
          <h2>Error</h2>
          <button class="close-btn" (click)="closeErrorModal()">√ó</button>
        </div>
        <div class="modal-body">
          <p class="error-message">{{ errorMessage }}</p>
        </div>
        <div class="modal-footer">
          <button class="submit-btn" (click)="closeErrorModal()">OK</button>
        </div>
      </div>
    </div>
  }

  <!-- Confirmation Modal -->
  @if (showConfirmModal) {
    <div class="modal-overlay" (click)="closeConfirmModal()">
      <div class="modal-content confirm-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <img src="/assets/warning.png" alt="Warning" style="width: 24px; height: 24px;">
          <h2>Are you sure?</h2>
          <button class="close-btn" (click)="closeConfirmModal()">√ó</button>
        </div>
        <div class="modal-body">
          <p class="confirm-message">{{ confirmMessage }}</p>
        </div>
        <div class="modal-footer">
          <button class="cancel-btn" (click)="closeConfirmModal()">Cancel</button>
          <button class="submit-btn delete-confirm-btn" (click)="confirmDelete()">OK</button>
        </div>
      </div>
    </div>
  }
</div>